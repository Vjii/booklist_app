<% include ../partials/header %>

	<main>

		<section class="profile">
			<div class="grid__row">

				<div class="grid__col grid__col--desktop-flex-1 grid__col--no-padding">
					<header class="profile__header">
						<div class="image__container image__container--profile">
							<img class="image" src="<%= collection.author.image %>">
						</div>
						<h2 class="profile__name"><%= collection.author.username %></h2>
					</header>
				</div>

				<div class="grid__col grid__col--desktop-flex-1 grid__col--no-padding">
					<div class="profile__body">
						<h2 class="profile__title">Favorite ideas: <%= collection.title %></h2>
						<% if (collection.books !== null) { %>
							<ul class="profile__list">
								<% collection.books.forEach(function(book) {%>
									<% book.ideas.forEach(function(idea) {%>
										<li class="profile__list-item">
											<h4 class="profile__idea"><%= idea.name %></h4>
										</li>
									<% }) %>
								<% })%>
							</ul>
						<% } %>
					</div>

					<% if (currentUser && collection.author.id.equals(currentUser._id)) { %>
						<a href="/collections/<%= collection._id%>/books/new">
							<button class="button">Add a new book</button>
						</a>
					<% } %>
				</div>
			</div>
		</section>


		<section class="wrapper--gutterless">
		<% collection.books.forEach(function(book) { %>
			<div class="layout__row book">
					<div class="col book__presentation">
						<h2 class="heading_margin-small heading__title"><%= book.title %></h2>
						<div class="image__container--thin-center">
							<img class="" src="<%= book.image %>">
						</div>

						<% if (currentUser && collection.author.id.equals(currentUser._id)) { %>
						<div class="book__buttons">
							<a class="button--horizontal" href="/collections/<%= collection._id%>/books/<%= book._id%>/ideas/new">
								<button class="button button__edit button_margin-horizontal button_margin-vertical">Add ideas</button>
							</a>
							<a class="button--horizontal" href="/collections/<%= collection._id%>/books/<%= book._id%>/edit">
								<button class="button button__edit button--horizontal button_margin-horizontal button_margin-vertical">Edit book</button>
							</a>
							<form class="form--delete" action="/collections/<%= collection._id%>/books/<%= book._id%>?_method=DELETE" method="POST">
								<button>Delete</button>
							</form>
						</div>
					<% } %>

					</div>

				<div class="col book__body">
					<% if (book.ideas) { %>
						<% book.ideas.forEach(function(idea) {%>
							<div class="book__ideas">
								<h3 class="heading__title vertical_margin-small"><%= idea.name%></h3>
								<p class="vertical_margin-small text_justified"><%= idea.description%></p>

								<% if (currentUser && collection.author.id.equals(currentUser._id)) { %>
									<div class="button__container">
										<a class="button--horizontal" href="/collections/<%= collection._id %>/books/<%= book._id%>/ideas/<%= idea._id%>/edit">
											<button class="button button__edit button_margin-horizontal button_margin-vertical">Edit
											</button>
										</a>
										<form class="button--horizontal" action="/collections/<%= collection._id%>/books/<%= book._id%>/ideas/<%= idea._id%>?_method=DELETE" method="POST">
											<button>Delete
											</button>
										</form>
									</div>
								<% } %>

							</div>
						<% }) %>
					<% } %>


				</div>

			</div>
		<% }); %>
		</section>

		<div class="layout__row comment__title">
			<div class="col">
				<h1 class="heading__title">Comment</h1>
			</div>
		</div>

		<% collection.comments.forEach(function(comment) { %>
			<div class="layout__row">
				<div class="layout__col">
				<div>


				</div>
	<!-- 			profile__presentation profile--theme-light
	 -->				<div class="image__container image__container--size-thumbnail">
						<img class="image image_rounded" src="<%= comment.author.image%>">
					</div>
					<h3 class="profile__name"><%= comment.author.username%></h3>
				</div>

				<div class="layout__col">
					<div class="comment__content">
						<p class="comment__date">Posted on
						<%= comment.date.toUTCString() %>
						</p>
						<p class="comment__text"><%= comment.text%></p>

						<% if (currentUser && collection.author.id.equals(currentUser._id)) { %>
							<div class="comment__buttons">
								<a href="/collections/<%= collection._id%>/comment/<%= comment._id%>/edit">
								<button class="button button__edit button_margin-horizontal">Edit</button>
								</a>
								<form action="/collections/<%= collection._id%>/comment/<%= comment._id%>?_method=DELETE" method="POST">
									<button class="button button__delete  button--delete">Delete</button>
								</form>
							</div>
						<% } %>
					</div>
				</div>


			</div>
		<% })%>
	</div>
</main>

<% include ../partials/footer %>



