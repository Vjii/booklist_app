<% include ../partials/header %>

	<main>
		<section class="profile">
			<div class="grid__row">

				<div class="grid__col grid__col--desktop-flex-1 grid__col--no-padding">
					<header class="profile__header">
						<div class="profile__image-wrapper">
							<img class="profile__image" src="<%= collection.author.image %>">
						</div>
						<h2 class="profile__name"><%= collection.author.username %></h2>
					</header>
				</div>

				<div class="grid__col grid__col--desktop-flex-3 grid__col--no-padding">
					<div class="profile__body">
						<h2 class="profile__title">Essential ideas</h2>
						<div class="list__container">
							<h3>Categories:</h3>
							<% if (collection.categories!== null) { %>
								<ul class="list">
									<% collection.categories.forEach(function(category) {%>
											<li class="list__item">
												<h4 class="list-item--content"><%= category.name %> </h4>
											</li>
									<% })%>
								</ul>
							<% } %>
						</div>
					</div>
				</div>
			</div>
		</section>

		<section class="categories">

			<% collection.categories.forEach(function(category) { %>
				<article class="categories__wrapper">
						<div class="grid__row ">
							<div class="grid__col grid__col--desktop-flex-3">
									<h2 class="categories__title"> <%= category.name %></h2>
							</div>
						</div>
					<% category.sources.forEach(function(source) {%>
						<section class="ideas">
							<div class="grid__row">
								<div class="grid__col ">
									<div class="ideas__cluster">
										<h3>Idea cluster</h3>
										<h3>Source: <%= source.kind %> - <%= source.name %></h3>
										<div class="categories__image-wrapper">
												<img class="categories__image" src="<%= source.image %>">
										</div>
										<% source.ideas.forEach(function(idea) { %>
											<div class="categories__ideas">
												<h3 class=""><%= idea.name%></h3>
												<p class=""><%= idea.description%></p>
												<% if (currentUser && collection.author.id.equals(currentUser._id)) { %>
													<div class="">
														<a class="" href="/collections/<%= collection._id %>/categories/<%= source._id%>/ideas/<%= idea._id%>/edit">
															<button class="button">Edit
															</button>
														</a>
														<form class="form" action="/collections/<%= collection._id%>/books/<%= source._id%>/ideas/<%= idea._id%>?_method=DELETE" method="POST">
															<button class="button">Delete
															</button>
														</form>
													</div>
												<% } %>
											</div>
										<% }) %>
								</div>
							</div>
						</section>
					<% })%>

					<div class="book__buttons">
						<% if (currentUser && collection.author.id.equals(currentUser._id)) { %>
						<a class="link link--equal" href="/collections/<%= collection._id%>/categories/new">
							Add book
						</a>
					<% } %>
						<a class="link link--equal" href="/collections/<%= collection._id%>/categories/<%= category._id%>/ideas/new">
							Add ideas
						</a>
						<a class="link link--equal" href="/collections/<%= collection._id%>/categories/<%= category._id%>/edit">
							Edit book
						</a>
						<form class="form--delete" action="/collections/<%= collection._id%>/categories/<%= category._id%>?_method=DELETE" method="POST">
							<button class="button button--delete">Delete book</button>
						</form>
					</div>
				</article>

			<% }); %>
		</section> <!-- <section class="books"> -->


		<div class="layout__row comment__title">
			<div class="col">
				<h1 class="heading__title">Comment</h1>
			</div>
		</div>

		<% collection.comments.forEach(function(comment) { %>
			<div class="layout__row">
				<div class="layout__col">
				<div>


				</div>
	<!-- 			profile__presentation profile-theme-light
	 -->				<div class="image__container image__container--size-thumbnail">
						<!-- <img class="image image_rounded" src="<%= comment.author.image%>"> -->
					</div>
					<h3 class="profile__name"><%= comment.author.username%></h3>
				</div>

				<div class="layout__col">
					<div class="comment__content">
						<p class="comment__date">Posted on
						<%= comment.date.toUTCString() %>
						</p>
						<p class="comment__text"><%= comment.text%></p>

						<% if (currentUser && collection.author.id.equals(currentUser._id)) { %>
							<div class="comment__buttons">
								<a href="/collections/<%= collection._id%>/comment/<%= comment._id%>/edit">
								<button class="button button__edit button_margin-horizontal">Edit</button>
								</a>
								<form action="/collections/<%= collection._id%>/comment/<%= comment._id%>?_method=DELETE" method="POST">
									<button class="button button__delete  button--delete button--delete">Delete</button>
								</form>
							</div>
						<% } %>
					</div>
				</div>


			</div>
		<% })%>
</main>


<% include ../partials/footer %>



